{% extends "base/diary_base.html" %}
{% load static %}

{% block body %}
<div class="mypage">

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« -->
    <section class="profile-card">
        <h2>{{ user_obj.username }}</h2>
        {% if user.profile_image %}
        <img src="{{ user.profile_image.url }}" class="avatar">
        {% else %}
        <img src="{% static 'images/default_avatar.png' %}" class="avatar">
        {% endif %}
        <div class="profile-actions">
            <a href="{% url 'accounts:profile_edit' %}">ç·¨é›†</a>
        
            <!-- {% if user.profile.profile_image %}
            <form method="post" action="{% url 'accounts:profile_image_delete' %}">
                {% csrf_token %}
                <button type="submit">ç”»åƒã‚’å‰Šé™¤</button>
            </form>
            {% endif %} -->
        </div>
        <!-- <h2>{{ user_obj.username }}</h2> -->
    </section>

    <!-- æ—¥è¨˜ -->
    <section class="content-card">
        <h3 class="section-title">ğŸ“” æ—¥è¨˜ä¸€è¦§</h3>

        {% for diary in diaries %}
        <div class="list-item">
            <a href="{% url 'diary:page_detail' diary.pk %}" class="item-title">
                {{ diary.title }}
            </a>
            <div class="item-meta">
                æŠ•ç¨¿æ—¥ï¼š{{ diary.page_date|date:"Yå¹´mæœˆdæ—¥" }}
            </div>
        </div>
        {% empty %}
        <p class="empty-text">æ—¥è¨˜ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
        {% endfor %}
    </section>

    <!-- ãƒ–ãƒ­ã‚° -->
    <section class="content-card">
        <h3 class="section-title">ğŸ“ ãƒ–ãƒ­ã‚°æŠ•ç¨¿</h3>

        {% for post in blog_posts %}
        <div class="list-item">
            <a href="{% url 'blog:post_detail' post.slug %}" class="item-title">
                {{ post.title }}
            </a>
            <div class="item-meta">
                æŠ•ç¨¿æ—¥ï¼š{{ post.posted_date|date:"Yå¹´mæœˆdæ—¥" }}
            </div>
        </div>
        {% empty %}
        <p class="empty-text">ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
        {% endfor %}
    </section>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <section class="content-card">
        <h3 class="section-title">ğŸ’Œ å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
    
        {% for msg in messages %}
        <div class="message-card">
            <strong>
                {% if msg.is_important %}
                <span class="important">â˜…</span>
                {% endif %}
        
                {{ msg.sender.username }}
        
                {% if not msg.is_read %}
                <span class="badge unread">æœªèª­</span>
                {% endif %}
            </strong>
        
            <p>{{ msg.content|truncatechars:50 }}</p>
        
            <small class="text-muted">
                {{ msg.sent_at|date:"Y/m/d H:i" }}
            </small>
        </div>
        {% empty %}
        <p class="empty-text">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</p>
        {% endfor %}
    </section>

</div>

<div class="logout-wrapper">
    <form action="{% url 'accounts:logout' %}" method="post">
        {% csrf_token %}
        <button class="logout-pill">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </form>
</div>

{% endblock %}