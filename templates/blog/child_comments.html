{% load comment_tags %}

{% for comment in comments %}

<div class="reply-indented">
    <p>
        <strong>{{ comment.name }}</strong>
        >>> <strong>{{ comment.reply_to }}</strong>
        <small>{{ comment.posted_date }}</small><br>
        {{ comment.body }}
    </p>

    <!-- 返信ボタン -->
    <button onclick="showReplyForm({{ comment.id }})">返信</button>

    <div id="reply-form-{{ comment.id }}" style="display:none;">
        <form method="post" action="{% url 'blog:post_detail' slug=comment.post.slug %}">
            {% csrf_token %}
            {{ reply_forms|dict_get:comment.id.as_p }}
            <input type="hidden" name="parent_comment" value="{{ comment.id }}">
            <input type="hidden" name="reply_to" value="{{ comment.name }}">
            <button class="button is-small is-success">返信</button>
        </form>
    </div>

    <!-- 子コメントがあれば再帰 -->
    {% if comment.replies.all %}
    <div class="reply-indented">
        {% include "blog/child_comments.html" with comments=comment.replies.all reply_forms=reply_forms %}
    </div>
    {% endif %}

</div>

{% endfor %}