{% load comment_tags %}
{% load youtube_extras %}
{% load static %}

{% for comment in comments %}
<div class="comment parent">

    <p>
        <strong>ã‚³ãƒ¡ãƒ³ãƒˆï¼š{{ comment.name }}</strong><br>
        {{ comment.body }}
    </p>

    {% if comment.replies.exists %}
    <button type="button" class="replies-toggle" data-comment-id="{{ comment.id }}">
        è¿”ä¿¡ã‚’è¦‹ã‚‹ï¼ˆ{{ comment.replies.count }}ä»¶ï¼‰
    </button>
    {% endif %}

    <div class="media-wrapper">
        {% if comment.image %}
        <img src="{{ comment.image.url }}" class="comment-media-thumb">
        {% endif %}

        
        {% include "blog/video_embed.html" with video_url=comment.video_url %}
            
    </div>

    <!-- =====================
         å­ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆè¿”ä¿¡ï¼‰
    ====================== -->
    <div id="replies-{{ comment.id }}" style="display:none; margin-left:20px;">

        {% for reply in comment.replies.all %}
        <div class="comment reply">

            <p>
                âˆŸ <strong>ã‚³ãƒ¡ãƒ³ãƒˆï¼š{{ reply.name }}</strong>
                {% if reply.reply_to %}
                ï¼ï¼ï¼ <strong>{{ reply.reply_to }}</strong>
                {% endif %}
                <br>
                {{ reply.body }}
            </p>

            {% if reply.image %}
            <img src="{{ reply.image.url }}" class="comment-media-thumb">
            {% endif %}

        
            {% include "blog/video_embed.html" with video_url=reply.video_url %}
                

            <!-- ğŸ”¥ è¿”ä¿¡ã¸ã®è¿”ä¿¡ï¼ˆreply.id ã§çµ±ä¸€ï¼‰ -->
            <button type="button" class="reply-toggle" data-reply-id="{{ reply.id }}">
                è¿”ä¿¡
            </button>

            <div id="reply-form-{{ reply.id }}" class="reply-form" style="display:none; margin-left:20px;">
                <form method="post" action="{% url 'blog:post_detail' slug=post.slug %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <input type="hidden" name="reply_to" value="{{ reply.name }}">
                    <button type="submit">é€ä¿¡</button>
                </form>
            </div>

        </div>
        {% endfor %}
    </div>

    <!-- =====================
         è¦ªã‚³ãƒ¡ãƒ³ãƒˆã¸ã®è¿”ä¿¡
    ====================== -->
    <button type="button" class="reply-toggle" data-reply-id="{{ comment.id }}">
        è¿”ä¿¡
    </button>

    <div id="reply-form-{{ comment.id }}" class="reply-form" style="display:none; margin-left:20px;">
        <form method="post" action="{% url 'blog:post_detail' slug=post.slug %}">
            {% csrf_token %}
            {{ form.as_p }}
            <input type="hidden" name="parent_id" value="{{ comment.id }}">
            <input type="hidden" name="reply_to" value="{{ comment.name }}">
            <button type="submit">é€ä¿¡</button>
        </form>
    </div>

</div>
<hr>
{% empty %}
<p>ã‚³ãƒ¡ãƒ³ãƒˆã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endfor %}

<script src="{% static 'blog/blog.js' %}"></script>

<script async src="https://www.tiktok.com/embed.js"></script>
<script async src="//www.instagram.com/embed.js"></script>
<script async src="https://platform.twitter.com/widgets.js"></script>