{% extends "base/diary_base.html" %}
{% load youtube_extras %}
{% load comment_tags %}
{% load static %}

{% block body %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}">

<small>Posted at {{ post.posted_date }}</small>
<br>
<small>投稿者： {{ post.name }}</small>

<h1 class="title">{{ post.title }}</h1>

<p>{{ post.body }}</p>

<div class="media-wrapper">

    {% if post.image and post.image.name %}
    <img src="{{ post.image.url }}" class="comment-media-thumb">
    {% endif %}

    {% if post.video_url %}
    
        {% if "youtube.com" in post.video_url or "youtu.be" in post.video_url %}
        <iframe width="100%" height="315"
            src="https://www.youtube.com/embed/{{ post.video_url|cut:'https://www.youtube.com/watch?v='|cut:'https://youtu.be/' }}"
            frameborder="0" allowfullscreen>
        </iframe>
        
        {% elif "tiktok.com" in post.video_url %}
        <blockquote class="tiktok-embed" cite="{{ post.video_url }}"></blockquote>
        
        {% elif "instagram.com" in post.video_url %}
        <blockquote class="instagram-media" data-instgrm-permalink="{{ post.video_url }}">
        </blockquote>
        
        {% elif "x.com" in post.video_url or "twitter.com" in post.video_url %}
        <blockquote class="twitter-tweet">
            <a href="{{ post.video_url }}"></a>
        </blockquote>
        
        {% elif "facebook.com" in post.video_url %}
        <iframe src="https://www.facebook.com/plugins/video.php?href={{ post.video_url }}" width="100%" height="315"
            style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen>
        </iframe>
        
        {% endif %}
    
    {% endif %}

</div>


<hr>

<h2 class="subtitle">コメントを書く</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button class="button is-success">コメントを投稿</button>
</form>


<hr>

<h2 class="subtitle">コメント一覧</h2>

{% include "blog/child_comments.html" with comments=parent_comments form=form %}

<hr>

<div id="media-modal" class="media-modal" onclick="closeMedia()">
    <div id="media-content"></div>
</div>


<script src="{% static 'blog/js/blog.js' %}"></script>

<script async src="https://www.tiktok.com/embed.js"></script>
<script async src="//www.instagram.com/embed.js"></script>
<script async src="https://platform.twitter.com/widgets.js"></script>

{% endblock %}