{% extends "base/diary_base.html" %}
{% load comment_tags %}
{% block body %}
{% load static %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}">

<small>Posted at {{ post.posted_date }}</small>
<br>
<small>投稿者： {{ post.name }}</small>

<h1 class="title">{{ post.title }}</h1>

<p>{{ post.body }}</p>

<div class="media-wrapper">

    {% if post.image %}
    <img src="{{ post.image.url }}" class="comment-media-thumb" onclick="openMedia('{{ post.image.url }}', 'image')">
    {% endif %}

    {% if post.video %}
    <div class="video-thumb" onclick="openMedia('{{ post.video.url }}', 'video')">
        ▶ 動画を見る
    </div>
    {% endif %}

</div>


<hr>

<h2 class="subtitle">コメントを書く</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button class="button is-success">コメントを投稿</button>
</form>


<hr>

<h2 class="subtitle">コメント一覧</h2>

{% include "blog/child_comments.html" with comments=parent_comments form=form %}

<hr>

<div id="media-modal" class="media-modal" onclick="closeMedia()">
    <div id="media-content"></div>
</div>


<script>
    function toggleReply(id) {
        const el = document.getElementById(`reply-form-${id}`);
        el.style.display = el.style.display === "none" ? "block" : "none";
    }
            function toggleReplies(id) {
    const el = document.getElementById(`replies-${id}`);
    if (!el) return;
    el.style.display = el.style.display === "none" ? "block" : "none";
}
</script>
<script>
    function openMedia(url, type) {
        const modal = document.getElementById("media-modal");
        const content = document.getElementById("media-content");

        content.innerHTML = "";

        if (type === "image") {
            content.innerHTML = `<img src="${url}">`;
        } else {
            content.innerHTML = `<video src="${url}" controls autoplay></video>`;
        }

        modal.style.display = "flex";
    }

    function closeMedia() {
        const modal = document.getElementById("media-modal");
        const content = document.getElementById("media-content");

        content.innerHTML = "";
        modal.style.display = "none";
    }
</script>

{% endblock %}