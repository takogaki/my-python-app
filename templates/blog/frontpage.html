{% extends "base/diary_base.html" %}
{% block body %}

<style>
    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¨ä½“ã‚’ä¸­å¤®æƒãˆã«ã™ã‚‹ */
    .content-container {
        max-width: 800px;
        /* æœ€å¤§å¹…ã‚’è¨­å®š */
        margin: 0 auto;
        /* å·¦å³ä¸­å¤®æƒãˆ */
        padding: 20px;
        /* å†…å´ã«ä½™ç™½ã‚’è¿½åŠ  */
    }

    .post {
        background-color: #f9f9f9;
        /* èƒŒæ™¯è‰² */
        padding: 20px;
        border-radius: 8px;
        /* è§’ã‚’ä¸¸ã‚ã‚‹ */
        margin-bottom: 20px;
        /* ä¸‹ã®ä½™ç™½ */
    }

    .post h2 {
        font-size: 1.5rem;
        /* ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚µã‚¤ã‚ºèª¿æ•´ */
    }

    .post small {
        font-size: 0.9rem;
        color: gray;
    }

    .post a {
        color: #007bff;
        /* ãƒªãƒ³ã‚¯è‰² */
        text-decoration: none;
    }

    .post a:hover {
        text-decoration: underline;
        /* ãƒ›ãƒãƒ¼æ™‚ã«ä¸‹ç·š */
    }

    .post-media-thumb {
    max-width: 200px;
    max-height: 200px;
    cursor: pointer;
    margin: 10px 0;
    border-radius: 6px;
    object-fit: cover;
}

.video-thumb {
    display: inline-block;
    padding: 8px 12px;
    background: #333;
    color: #fff;
    border-radius: 6px;
    cursor: pointer;
    margin: 10px 0;
}

.media-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.media-modal img,
.media-modal video {
    max-width: 90%;
    max-height: 90%;
}
</style>

<h2>å£ã‚’é–‹ã</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">å£ã‚’ã¨ã˜ã‚‹</button>
</form>

{% for post in posts %}

<a href="{% url 'blog:post_detail' slug=post.slug %}">{{ post.title }}</a>

<div class="post block">
    <!-- æŠ•ç¨¿è€…å -->
    <p><strong>æŠ•ç¨¿è€…: </strong>{{ post.name }}</p>

    <h2 class="subtitle">{{ post.title }}</h2>
    <small>Posted at {{ post.posted_date }}</small>

<p>{{ post.body|truncatechars:120 }}</p>

    <!-- ğŸ”½ ç”»åƒã‚µãƒ ãƒ -->
    {% if post.image %}
    <img src="{{ post.image.url }}" class="post-media-thumb" onclick="openMedia('{{ post.image.url }}', 'image')">
    {% endif %}

    <!-- ğŸ”½ å‹•ç”»ã‚µãƒ ãƒ -->
    {% if post.video %}
    <div class="video-thumb" onclick="openMedia('{{ post.video.url }}', 'video')">
        â–¶ å‹•ç”»ã‚’è¦‹ã‚‹
    </div>
    {% endif %}

    <br>
    <a href="{% url 'blog:post_detail' slug=post.slug %}">ã‚‚ã£ã¨èª­ã‚€</a>
</div>

{% endfor %}

<!-- ğŸ”½ ãƒ¡ãƒ‡ã‚£ã‚¢è¡¨ç¤ºç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå¿…é ˆï¼‰ -->
<div id="media-modal" class="media-modal" onclick="closeMedia()">
    <div id="media-content"></div>
</div>

<script>
    function openMedia(url, type) {
        const modal = document.getElementById("media-modal");
        const content = document.getElementById("media-content");

        if (!modal || !content) {
            console.error("media modal not found");
            return;
        }

        content.innerHTML = "";

        if (type === "image") {
            content.innerHTML = `<img src="${url}" style="max-width:90vw; max-height:90vh;">`;
        } else {
            content.innerHTML = `<video src="${url}" controls autoplay style="max-width:90vw; max-height:90vh;"></video>`;
        }

        modal.style.display = "flex";
    }

    function closeMedia() {
        const modal = document.getElementById("media-modal");
        const content = document.getElementById("media-content");
        if (!modal || !content) return;

        content.innerHTML = "";
        modal.style.display = "none";
    }
</script>

{% endblock %}