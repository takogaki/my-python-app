{% extends "base/diary_base.html" %}
{% load static %}

{% block body %}
<link rel="stylesheet" href="{% static 'diary/css/base.css' %}">

<div class="content-container">

    <!-- æ—¥è¨˜è©³ç´°ã‚«ãƒ¼ãƒ‰ -->
    <div class="post-detail-card">

        <div class="post-meta">
            <small>ğŸ•’ {{ page.page_date }}</small><br>
            <small>âœï¸ {{ page.author }}</small>
        </div>

        <h1 class="post-title">{{ page.title }}</h1>

        <div class="post-body">
            {{ page.body|linebreaks }}
        </div>

        {% if page.picture %}
        <div class="media-wrapper">
            <img src="{{ page.picture.url }}" class="comment-media-thumb">
        </div>
        {% endif %}

        <!-- ä½œæˆè€…ã®ã¿ç·¨é›†ãƒ»å‰Šé™¤ -->
        {% if page.author == request.user %}
        <div class="action-area">
            <a href="{% url 'diary:page_update' page.id %}" class="action-link">âœï¸ ç·¨é›†</a>
            <a href="{% url 'diary:page_delete' page.id %}" class="action-link danger">ğŸ—‘ å‰Šé™¤</a>
        </div>
        {% endif %}
    </div>

    <!-- ğŸ‘ ã„ã„ã­ã‚¨ãƒªã‚¢ -->
    <div class="info-card">

        {% if page.author == request.user %}
        <p class="info-text">
            <strong>
                {{ page.unique_likes_count }}äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰
                {{ page.likes }} ğŸ‘ ã‚‚ã‚‰ã£ã¦ã„ã¾ã™
            </strong>
        </p>
        {% else %}
        <p>ç¾åœ¨ã®ğŸ‘æ•°ï¼š<strong id="likes-count">{{ page.likes }}</strong></p>
        <p>ğŸ‘ã—ãŸãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼š<strong id="unique-users-count">{{ page.unique_likes_count }}</strong></p>
        <p>ã‚ãªãŸã®ğŸ‘å›æ•°ï¼š<strong id="user-likes-count">0</strong></p>

        <button id="like-button" class="submit-btn">ğŸ‘ ã„ã„ã­ã™ã‚‹</button>
        {% endif %}
    </div>

    <!-- æˆ»ã‚‹ -->
    <div class="back-area">
        <a href="{% url 'accounts:mypage' %}" class="back-button">â† æˆ»ã‚‹</a>
    </div>

</div>

{% if page.author != request.user %}
<script>
    document.getElementById('like-button').addEventListener('click', function () {
        fetch(`/diary/like/{{ page.id }}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('likes-count').textContent = data.likes;
                document.getElementById('unique-users-count').textContent = data.unique_users;
                document.getElementById('user-likes-count').textContent = data.user_like_count;
            })
            .catch(error => console.error(error));
    });
</script>
{% endif %}

{% endblock %}