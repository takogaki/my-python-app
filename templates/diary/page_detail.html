{% extends "base/diary_base.html" %}
{% block body %}

<h2>{{ page.title }}</h2>
<div>{{ page.page_date }}</div>
<div>{{ page.body | linebreaksbr }}</div>

{% if page.picture %}
<img src="{{ page.picture.url }}" alt="æ—¥è¨˜ã®å†™çœŸ" />
{% endif %}

<br>

<!-- ä½œæˆè€…ã®ã¿ãŒç·¨é›†ãƒ»å‰Šé™¤å¯èƒ½ -->
{% if page.author == request.user %}
<a href="{% url 'diary:page_update' page.id %}">ç·¨é›†</a>
<a href="{% url 'diary:page_delete' page.id %}">å‰Šé™¤</a>
{% endif %}

<br>

<!-- è‡ªåˆ†ã®æ—¥è¨˜ã‹ã©ã†ã‹ã§åˆ†å² -->
{% if page.author == request.user %}
<!-- è‡ªåˆ†ã®æ—¥è¨˜ã®å ´åˆã¯ğŸ‘æ•°ã¨ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®ã¿è¡¨ç¤º -->
<p>
    <strong>
        {{ page.unique_likes_count }}äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€{{ page.likes }} ğŸ‘é ‚ã„ã¦ã„ã‚‹æ—¥è¨˜ã§ã™ã€‚
    </strong>
</p>
{% else %}
<!-- ä»–äººã®æ—¥è¨˜ã®å ´åˆã¯ğŸ‘ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º -->
<p>ç¾åœ¨ã®ğŸ‘æ•°: <span id="likes-count">{{ page.likes }}</span></p>
<p>ğŸ‘ã‚’æŠ¼ã—ãŸãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: <span id="unique-users-count">{{ page.unique_likes_count }}</span></p>
<p>ã‚ãªãŸãŒã“ã®æ—¥è¨˜ã«æŠ¼ã—ãŸğŸ‘ã®å›æ•°: <span id="user-likes-count">0</span></p>

<!-- ã„ã„ã­ãƒœã‚¿ãƒ³ -->
<button id="like-button">ğŸ‘ è‰¯ã„ã­ã™ã‚‹</button>

<!-- JavaScriptéƒ¨åˆ† -->
<script>
    // ã„ã„ã­ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('like-button').addEventListener('click', function () {
            fetch(`/diary/like/{{ page.id }}/`, { // ã„ã„ã­APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ä¿¡
                },
            })
                .then(response => response.json()) // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’JSONå½¢å¼ã§å—ã‘å–ã‚‹
                .then(data => {
                    // ğŸ‘æ•°ã¨ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’æ›´æ–°
                    document.getElementById('likes-count').textContent = data.likes;
                    document.getElementById('unique-users-count').textContent = data.unique_users;

                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ã„ã„ã­å›æ•°ã‚’è¡¨ç¤º
                    document.getElementById('user-likes-count').textContent = data.user_like_count;
                })
                .catch(error => console.error('Error:', error)); // ã‚¨ãƒ©ãƒ¼å‡¦ç†
        });
</script>
{% endif %}

<br>
<button onclick="history.back()">æˆ»ã‚‹</button>

{% endblock %}