{% extends "base/diary_base.html" %}
{% block body %}

<h1>{{ user.username }} ã®å…¬é–‹æ—¥è¨˜</h1>
<ul>
    {% for diary in diaries %}
    <li>
        <strong>{{ diary.title }}</strong> ({{ diary.created_at|date:"Y-m-d" }})
        <p>{{ diary.content }}</p>
    </li>
    {% endfor %}
</ul>

{% for diary in diaries %}
<article class="media">
    <div class="media-content">
        <h2>{{ diary.title }}</h2>
        <p>{{ diary.content }}</p>
        <small>æŠ•ç¨¿è€…: {{ diary.author.username }}</small>
        <p>ğŸ‘ <span id="likes-{{ diary.id }}">{{ diary.likes }}</span></p>
        <button class="like-button" data-diary-id="{{ diary.id }}">ã„ã„ã­</button>
    </div>
</article>
<hr>
{% endfor %}

<script>
    // ã„ã„ã­ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‡¦ç†
    document.querySelectorAll('.like-button').forEach(button => {
        button.addEventListener('click', function () {
            const diaryId = this.dataset.diaryId;  // æ—¥è¨˜IDã‚’å–å¾—
            const likesSpan = document.getElementById(`likes-${diaryId}`);  // ã„ã„ã­æ•°ã®è¡¨ç¤ºéƒ¨åˆ†

            // Ajaxã§ã„ã„ã­æ•°ã‚’æ›´æ–°
            fetch(`/diary/like/${diaryId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',  // CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’é€ä¿¡
                },
            })
                .then(response => response.json())
                .then(data => {
                    likesSpan.textContent = data.likes;  // æ›´æ–°ã•ã‚ŒãŸã„ã„ã­æ•°ã‚’è¡¨ç¤º
                })
                .catch(error => console.error('Error:', error));
        });
    });
</script>

{% endblock %}